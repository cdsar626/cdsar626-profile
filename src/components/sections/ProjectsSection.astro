---
import { getCollection } from 'astro:content';
import ProjectCard from '../ui/ProjectCard.astro';

// Fetch and sort projects from content collections
const allProjects = await getCollection('projects');

// Sort projects by featured status first, then by order, then by publish date
const sortedProjects = allProjects.sort((a, b) => {
  // Featured projects first
  if (a.data.featured && !b.data.featured) return -1;
  if (!a.data.featured && b.data.featured) return 1;
  
  // Then by order (lower numbers first)
  if (a.data.order !== b.data.order) {
    return a.data.order - b.data.order;
  }
  
  // Finally by publish date (newest first)
  return new Date(b.data.publishDate).getTime() - new Date(a.data.publishDate).getTime();
});
---

<section class="projects-section" id="projects">
  <div class="projects-container">
    <header class="projects-header">
      <h2 class="projects-title">Featured Projects</h2>
      <p class="projects-subtitle">
        A showcase of my recent work and technical expertise
      </p>
    </header>
    
    <div class="projects-grid" role="list">
      {sortedProjects.map((project, index) => (
        <div 
          class="projects-grid__item" 
          role="listitem"
          style={`--animation-delay: ${index * 0.1}s`}
        >
          <ProjectCard
            title={project.data.title}
            description={project.data.description}
            technologies={project.data.technologies}
            thumbnail={project.data.thumbnail}
            links={project.data.links}
            featured={project.data.featured}
          />
        </div>
      ))}
    </div>
    
    {sortedProjects.length === 0 && (
      <div class="projects-empty">
        <p>No projects available at the moment.</p>
      </div>
    )}
  </div>
</section>

<style>
  .projects-section {
    padding: var(--space-20) 0;
    background: var(--color-gray-50);
    position: relative;
  }
  
  .projects-container {
    max-width: var(--max-width-6xl);
    margin: 0 auto;
    padding: 0 var(--space-6);
  }
  
  .projects-header {
    text-align: center;
    margin-bottom: var(--space-16);
    opacity: 0;
    transform: translateY(20px);
    animation: fadeInUp 0.8s ease-out forwards;
  }
  
  .projects-title {
    font-size: var(--font-size-4xl);
    font-weight: var(--font-weight-bold);
    color: var(--color-gray-900);
    margin-bottom: var(--space-4);
    line-height: var(--line-height-tight);
  }
  
  .projects-subtitle {
    font-size: var(--font-size-lg);
    color: var(--color-gray-600);
    max-width: 600px;
    margin: 0 auto;
    line-height: var(--line-height-relaxed);
  }
  
  .projects-grid {
    display: grid;
    gap: var(--space-8);
    grid-template-columns: 1fr;
  }
  
  .projects-grid__item {
    opacity: 0;
    transform: translateY(30px);
    animation: fadeInUp 0.6s ease-out forwards;
    animation-delay: var(--animation-delay, 0s);
  }
  
  .projects-empty {
    text-align: center;
    padding: var(--space-16);
    color: var(--color-gray-500);
    font-size: var(--font-size-lg);
  }
  
  /* Tablet Layout - 2 columns */
  @media (min-width: 768px) {
    .projects-container {
      padding: 0 var(--space-8);
    }
    
    .projects-grid {
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-10);
    }
    
    .projects-title {
      font-size: var(--font-size-5xl);
    }
  }
  
  /* Desktop Layout - 3 columns */
  @media (min-width: 1024px) {
    .projects-section {
      padding: var(--space-24) 0;
    }
    
    .projects-container {
      padding: 0 var(--space-12);
    }
    
    .projects-grid {
      grid-template-columns: repeat(3, 1fr);
      gap: var(--space-12);
    }
    
    .projects-header {
      margin-bottom: var(--space-20);
    }
    
    .projects-title {
      font-size: var(--font-size-6xl);
    }
  }
  
  /* Large Desktop - maintain 3 columns with better spacing */
  @media (min-width: 1280px) {
    .projects-grid {
      gap: var(--space-16);
    }
  }
  
  /* Animation Keyframes */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* Reduced Motion Support */
  @media (prefers-reduced-motion: reduce) {
    .projects-header,
    .projects-grid__item {
      animation: none;
      opacity: 1;
      transform: none;
    }
  }
  
  /* High Contrast Mode Support */
  @media (prefers-contrast: high) {
    .projects-section {
      background: var(--color-white);
      border-top: 2px solid var(--color-gray-900);
      border-bottom: 2px solid var(--color-gray-900);
    }
    
    .projects-title {
      color: var(--color-black);
    }
    
    .projects-subtitle {
      color: var(--color-gray-800);
    }
  }
  
  /* Focus Management for Accessibility */
  .projects-section:focus-within {
    outline: none;
  }
  
  /* Print Styles */
  @media print {
    .projects-section {
      background: white;
      padding: var(--space-8) 0;
    }
    
    .projects-grid {
      grid-template-columns: 1fr;
      gap: var(--space-6);
    }
    
    .projects-header,
    .projects-grid__item {
      animation: none;
      opacity: 1;
      transform: none;
    }
  }
</style>